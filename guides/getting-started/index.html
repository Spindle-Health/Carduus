
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
        <link rel="next" href="../../api/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>Getting Started - Carduus</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Carduus" class="md-header__button md-logo" aria-label="Carduus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Carduus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Carduus" class="md-nav__button md-logo" aria-label="Carduus" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Carduus
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encryption-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-new-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Generating New Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-keys-to-carduus" class="md-nav__link">
    <span class="md-ellipsis">
      Providing Keys to Carduus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenization" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transcryption" class="md-nav__link">
    <span class="md-ellipsis">
      Transcryption
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transcryption">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sender" class="md-nav__link">
    <span class="md-ellipsis">
      Sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recipient" class="md-nav__link">
    <span class="md-ellipsis">
      Recipient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-key-provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Key Provider
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Carduus on Databricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-tokens/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Defining Token Specs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom-pii/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Custom PII
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OPPRL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            OPPRL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../opprl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../opprl/PROTOCOL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../opprl/contrib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Project
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Project
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LICENSE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#encryption-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Encryption Keys
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Encryption Keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-new-keys" class="md-nav__link">
    <span class="md-ellipsis">
      Generating New Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-keys-to-carduus" class="md-nav__link">
    <span class="md-ellipsis">
      Providing Keys to Carduus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenization" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transcryption" class="md-nav__link">
    <span class="md-ellipsis">
      Transcryption
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transcryption">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sender" class="md-nav__link">
    <span class="md-ellipsis">
      Sender
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recipient" class="md-nav__link">
    <span class="md-ellipsis">
      Recipient
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="getting-started">Getting Started</h1>
<p>This guide provides a quick tour of the main features of Carduus, including instructions for how most users will be interacting with the library.</p>
<blockquote>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> Carduus has not reached a v1.0 release yet and therefore the API and behaviors are subject to change. <strong>Use at your own risk!</strong> See the <a href="../../CONTRIBUTING/">contributing</a> guide if you would like to help the project.</p>
</blockquote>
<h2 id="installation">Installation</h2>
<p>Carduus is a cross-platform python library built on top of PySpark. It supports the following range of versions:</p>
<ul>
<li>Python: 3.9+</li>
<li>PySpark: 3.5+</li>
</ul>
<p>The latest stable release of carduus can be installed from <a href="">PyPI</a> into your active Python environment using <code>pip</code>.</p>
<div class="highlight"><pre><span></span><code>pip install carduus
</code></pre></div>
<p>You can also build Carduus from source using <a href="https://python-poetry.org/">Poetry</a>. The source code is hosted <a href="https://github.com/Spindle-Health/carduus">on Github</a>. Checkout the commit you wish to build and run  <code>poetry build</code> in the project's root.</p>
<h2 id="encryption-keys">Encryption Keys</h2>
<p>Carduus's tokenization capabilities require the use of private and public encryption keys. Carduus users are expected to manage their own encryption keys.</p>
<p>There are 3 kinds of encryption keys that play different roles:</p>
<ol>
<li>Your private RSA key - Used to transcrypt incoming data and derive a symmetric encryption key used to tokenize PII. <strong>This key must never be shared or accessed by untrusted parties.</strong></li>
<li>Your public RSA key - The public key counterpart to your private key. Will be shared with trusted parties that will be sending you tokenized data.</li>
<li>Trusted partner public keys - A collection of public keys from the various trusted parties that you will be sending tokenized to.</li>
</ol>
<h3 id="generating-new-keys">Generating New Keys</h3>
<p>Carduus expects encryption keys to be represented the <a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail">PEM</a> encoding. Private keys should use the <a href="https://en.wikipedia.org/wiki/PKCS_8">PKCS #8</a> format and public keys should be formatted as <a href="https://www.rfc-editor.org/rfc/rfc5280#section-4.1">SubjectPublicKeyInfo</a>. Carduus recommends a key size of 2048 bits.</p>
<p>You can generate these keys using tools like <a href="https://www.openssl.org/"><code>openssl</code></a> or by calling the <code>generate_pem_keys</code> function provided by Carduus. This function will return a <code>tuple</code> containing 2 instances of <code>bytes</code>. The first is the PEM data for your private key that you must keep secret. The second is the PEM data for your public key that can may share with the parties you intend to receive data from.</p>
<p>You can decode these keys into strings of text (using UTF-8) or write them into a <code>.pem</code> file for later use. </p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">carduus.keys</span> <span class="kn">import</span> <span class="n">generate_pem_keys</span>

<span class="n">private</span><span class="p">,</span> <span class="n">public</span> <span class="o">=</span> <span class="n">generate_pem_keys</span><span class="p">()</span>  <span class="c1"># Or provide key_size= </span>

<span class="nb">print</span><span class="p">(</span><span class="n">private</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="c1"># -----BEGIN PRIVATE KEY-----</span>
<span class="c1"># ... [ Base64-encoded private key ] ...</span>
<span class="c1"># -----END PRIVATE KEY-----</span>

<span class="nb">print</span><span class="p">(</span><span class="n">public</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="c1"># -----BEGIN PUBLIC KEY-----</span>
<span class="c1"># ... [ Base64-encoded public key ] ...</span>
<span class="c1"># -----END PUBLIC KEY-----</span>
</code></pre></div>
<h3 id="providing-keys-to-carduus">Providing Keys to Carduus</h3>
<p>Carduus has multiple ways of for users to provide their encryption keys.</p>
<p>The default option is to load encryption keys as Spark session configuration properties. This behavior is designed to integrate with secret management services that inject secrets into the Spark session properties, such as the <a href="https://docs.databricks.com/en/security/secrets/secrets.html#use-a-secret-in-a-spark-configuration-property-or-environment-variable">Databricks secret manager</a>. For more information on using Carduus on Databricks, see the <a href="../databricks/">Databricks usage guide</a>.</p>
<p>Your private key is stored under the <code>carduus.token.privateKey</code> property. The public keys of each party you send data to is stored under a property with the prefix <code>carduus.token.publicKey.</code> followed by the name you would like to associate with the party. For example, the public key for <em>Acme Corp</em> would be stored under the <code>carduus.token.publicKey.AcmeCorp</code> property.</p>
<p>These properties can be set when starting the spark cluster, or at runtime using the <code>SparkSession</code> method <code>.conf.set()</code> as shown below.</p>
<blockquote>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> The following snippet is only a demonstration. You should never hard-code your private encryption keys.
Instead you should call out to a dedicated secret management service that ensure only authorized users are accessing the key.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Get a reference to the active spark session or create one with SparkSession.builder.getOrCreate()</span>
<span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span> <span class="o">=</span> <span class="o">...</span> 

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
  <span class="s2">&quot;carduus.token.privateKey,</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;-----BEGIN PRIVATE KEY-----</span>
<span class="sd">... [ Base64-encoded private key ] ...</span>
<span class="sd">-----END PRIVATE KEY-----</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
  <span class="s2">&quot;carduus.token.publicKey.AcmeCorp&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;-----BEGIN PUBLIC KEY-----</span>
<span class="sd">... [ Base64-encoded public key ] ...</span>
<span class="sd">-----END PUBLIC KEY-----</span>
<span class="sd">&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>Carduus also provides an <a href="../../api/#encryption-key-management"><code>SimpleKeyProvider</code></a> class that simply holds an in-memory collection of keys as instances of <code>bytes</code>.This allows users to manage all encryption keys using whatever method they way and </p>
<p>Some users may way a more tightly coupled integration between Carduus and their preferred system for managing secrets and encryption keys. For example, you may wish for Carduus to delegate to your authentication or access control services before giving Carduus, and the user, access to certain keys. To solve this problem, Carduus accepts any implementation of the <a href="../../api/#encryption-key-management"><code>EncryptionKeyProvider</code></a> interface. See the <a href="../custom-key-provider/">custom key provider</a> guide for more details.</p>
<h2 id="tokenization">Tokenization</h2>
<p>Tokenization refers to the process of replacing PII with encrypted tokens using a one-way cryptographic function. Carduus implements the OPPRL tokenization protocol, which performs a standard set of PII normalizations and enhancements such that records pertaining to the same subject are more likely to receive the same token despite minor differences in PII representation across records. The OPPRL protocol hashes the normalized PII and then encrypts the hashes with a symmetric encryption based on a secret key derived from your private RSA key. In the event that the private encryption key of one party is compromised, there risk to all other parties is mitigated by the fact that everyone's tokens are encrypted with a different key.</p>
<p>To demonstrate the tokenization process, we will use a dataset of 5 records shown below. Each record is assigned a <code>label</code> that corresponds to the true identity of the subject.</p>
<div class="highlight"><pre><span></span><code><span class="n">pii</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Jonas&quot;</span><span class="p">,</span> <span class="s2">&quot;Salk&quot;</span><span class="p">,</span> <span class="s2">&quot;male&quot;</span><span class="p">,</span> <span class="s2">&quot;1914-10-28&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;jonas&quot;</span><span class="p">,</span> <span class="s2">&quot;salk&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;1914-10-28&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Elizabeth&quot;</span><span class="p">,</span> <span class="s2">&quot;Blackwell&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;1821-02-03&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Edward&quot;</span><span class="p">,</span> <span class="s2">&quot;Jenner&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;1749-05-17&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Alexander&quot;</span><span class="p">,</span> <span class="s2">&quot;Fleming&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;1881-08-06&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;first_name&quot;</span><span class="p">,</span> <span class="s2">&quot;last_name&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;birth_date&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">pii</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># +-----+----------+---------+------+----------+</span>
<span class="c1"># |label|first_name|last_name|gender|birth_date|</span>
<span class="c1"># +-----+----------+---------+------+----------+</span>
<span class="c1"># |    1|     Jonas|     Salk|  male|1914-10-28|</span>
<span class="c1"># |    1|     jonas|     salk|     M|1914-10-28|</span>
<span class="c1"># |    2| Elizabeth|Blackwell|     F|1821-02-03|</span>
<span class="c1"># |    3|    Edward|   Jenner|     m|1749-05-17|</span>
<span class="c1"># |    4| Alexander|  Fleming|     M|1881-08-06|</span>
<span class="c1"># +-----+----------+---------+------+----------+</span>
</code></pre></div>
<p>To perform tokenization, call the <code>tokenize</code> function and pass it the PII <code>DataFrame</code>, a column mapping, and a collection of specifications for token you want to generate. You may optionally pass an instance of <code>EncryptionKeyProvider</code>, but all code snippets shown in this guide assume the default key service is used (unless otherwise specified) and therefore encryption keys will be read from the spark session properties.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">carduus.token</span> <span class="kn">import</span> <span class="n">tokenize</span><span class="p">,</span> <span class="n">OpprlPii</span><span class="p">,</span> <span class="n">OpprlToken</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenize</span><span class="p">(</span>
    <span class="n">pii</span><span class="p">,</span>
    <span class="n">pii_transforms</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">first_name</span><span class="o">=</span><span class="n">OpprlPii</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="n">OpprlPii</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span>
        <span class="n">gender</span><span class="o">=</span><span class="n">OpprlPii</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span>
        <span class="n">birth_date</span><span class="o">=</span><span class="n">OpprlPii</span><span class="o">.</span><span class="n">birth_date</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">tokens</span><span class="o">=</span><span class="p">[</span><span class="n">OpprlToken</span><span class="o">.</span><span class="n">token1</span><span class="p">,</span> <span class="n">OpprlToken</span><span class="o">.</span><span class="n">token2</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |label|       opprl_token_1|       opprl_token_2|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |    1|d2tUj3yRFPIBSwR/n...|DQhKG+AMgrFh16dLi...|</span>
<span class="c1"># |    1|d2tUj3yRFPIBSwR/n...|DQhKG+AMgrFh16dLi...|</span>
<span class="c1"># |    2|2wnRWhN9Y4DBMeuvw...|A7fUKAZi/Ra2T6p8y...|</span>
<span class="c1"># |    3|I17X+CT3kjqB9l0rA...|qGCUVyI7MJLkQ9SSr...|</span>
<span class="c1"># |    4|6Ee3NabHaa/lyKsrp...|dbwNqy0rN6hFoHJYn...|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
</code></pre></div>
<p>Notice that both records with <code>label = 1</code> received the same pair of tokens despite slight representation differences in the original PII.</p>
<p>The <code>pii_transforms</code> argument is a dictionary that maps column names from the <code>pii</code> DataFrame to the corresponding OPPRL PII field. This tells Carduus how to normalize and enhance the values found in that column. For example, the <code>OpprlPii.first_name</code> object will apply name cleaning rules to the values found in the <code>first_name</code> column and automatically derive additional PII columns called <code>first_initial</code> and <code>first_soundex</code> which are used to create both OPPRL tokens.</p>
<p>The <code>tokens</code> argument is collection of OPPRL token specifications that tell Carduus which PII fields to jointly hash and encrypt to create each token. The current OPPRL protocol supports two token specifications, described below:</p>
<table>
<thead>
<tr>
<th>Token</th>
<th>Fields to jointly encrypt</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OpprlToken.token1</code></td>
<td><code>first_initial</code>, <code>last_name</code>, <code>gender</code>, <code>birth_date</code></td>
</tr>
<tr>
<td><code>OpprlToken.token2</code></td>
<td><code>first_soundex</code>, <code>last_soundex</code>, <code>gender</code>, <code>birth_date</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p><img alt="💡" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4a1.svg" title=":bulb:" /> <strong>Why two tokens?</strong> </p>
<p>Each use case has a different tolerance for false positive and false negative matches. By producing multiple tokens for each record using PII attributes, each user can customize their match logic to trade-off between different kinds of match errors. Linking records that match on <em>either</em> token will result in fewer false negatives, and linking records that match <em>both</em> tokens will result in fewer false positives.</p>
</blockquote>
<h2 id="transcryption">Transcryption</h2>
<blockquote>
<p><img alt="📖" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4d6.svg" title=":book:" /> noun: <em>trans-</em> (latin: across) <em>-crypt</em> (greek: hidden, secret)</p>
<p>The process of transforming a ciphertext produced by one encryption into a ciphertext of a different encryption without emitting the original plaintext.</p>
</blockquote>
<p>Transcryption is performed when a user wants to share tokenized data with another party. The sender and recipient each have a corresponding transcryption function that must be invoked to ensure safe transfer of data between trusted parties. The sender performs transcryption to replace their tokens with "ephemeral tokens" that are specific to the transaction. In other words, the ephemeral tokens do not match the sender's tokens, the recipients data, or the ephemeral tokens from prior transactions between <em>any</em> sender and recipient. </p>
<p>Furthermore, records from the same dataset that have identical PII will be assigned unique ephemeral tokens. This destroys the utility of the tokens until the recipient performs the reverse transcryption process using their private key. This is beneficial in the event that a third party gains access to the dataset during transfer (eg. an if transcrypted datasets are delivered over an insecure connection) because records pertaining to the same subject cannot be associated with each other.</p>
<h3 id="sender">Sender</h3>
<p>Carduus provides the <code>transcrypt_out</code> function in for the sender to call on their tokenized datasets. In the following code snippet, notice the 2 records pertaining to the same subject (<code>label = 1</code>) no longer have identical tokens. The <code>tokens_to_send</code> DataFrame can safely be written files or a database and delivered to the recipient.</p>
<div class="highlight"><pre><span></span><code><span class="n">tokens_to_send</span> <span class="o">=</span> <span class="n">transcrypt_out</span><span class="p">(</span>
    <span class="n">tokens</span><span class="p">,</span> 
    <span class="n">token_columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;opprl_token_1&quot;</span><span class="p">,</span> <span class="s2">&quot;opprl_token_2&quot;</span><span class="p">),</span> 
    <span class="n">recipient</span><span class="o">=</span><span class="s2">&quot;AcmeCorp&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">tokens</span><span class="o">.</span><span class="n">to_send</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |label|       opprl_token_1|       opprl_token_2|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |    1|IL17HgISJv5ol+ftJ...|YPnfuGBBhbOZChlhR...|</span>
<span class="c1"># |    1|IVwfYY0dbmFc6cf0/...|jF8N2HYEYPr5lFSSx...|</span>
<span class="c1"># |    2|I5Oe3oC0heF8L+Zcy...|BkBPzMDXeKlprUd8l...|</span>
<span class="c1"># |    3|dOQtYZZV8j/E6wGMB...|FU6MbMjsU8WrJoiXa...|</span>
<span class="c1"># |    4|N0VzhvFHrTtWNt+P7...|jvbFTWbmBzB06lDpv...|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
</code></pre></div>
<p>The <code>token_columns</code> argument is a iterable collection containing the column names of the <code>tokens</code> DataFrame that correspond to tokens that need to be transcrypted.</p>
<p>The <code>recipient</code> argument denotes the name given to the public key associated with the intended recipient. If using the default encryption key provider (via Spark session properties) the above code snippet will grab the public key from <code>carduus.token.publicKey.AcmeCorp</code> spark session property.</p>
<h3 id="recipient">Recipient</h3>
<p>The <code>transcrypt_in</code> function provides the transcryption process for the recipient. It is called on a dataset produced by the sender using <code>transcrypt_out</code> to convert ephemeral tokens into normal tokens that will match other tokenized datasets maintained by the recipient, including prior datasets delivered from the same sender.</p>
<p>For this demonstration, we will load the private encryption key of our hypothetical recipient, Acme Corp, in order to process the ephemeral tokens we created in the previous section as if we were operating in the recipient's environment. This is done using an <code>SimpleKeyProvider</code> that is passed to the transcryption function to override where Carduus pull keys from.</p>
<p>Notice that the first 2 records pertaining to the same subject (label = 1) have identical tokens again, but do these tokens are not the same as the original tokens because they are encrypted with the scheme for the recipient.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">carduus.keys</span> <span class="kn">import</span> <span class="n">SimpleKeyProvider</span>
<span class="kn">from</span> <span class="nn">carduus.token</span> <span class="kn">import</span> <span class="n">transcrypt_in</span>

<span class="n">acme_keys</span> <span class="o">=</span> <span class="n">SimpleKeyProvider</span><span class="p">(</span>
  <span class="c1"># Another reminder to never hardcode your private encryption keys in real use cases!</span>
  <span class="n">private_key</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;&quot;&quot;-----BEGIN PRIVATE KEY-----</span>
<span class="s2">... [ Base64-encoded private key ] ...</span>
<span class="s2">-----END PRIVATE KEY-----</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
  <span class="n">public_keys</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>

<span class="n">acme_tokens</span> <span class="o">=</span> <span class="n">transcrypt_in</span><span class="p">(</span>
    <span class="n">tokens_to_send</span><span class="p">,</span> 
    <span class="n">token_columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;opprl_token_1&quot;</span><span class="p">,</span> <span class="s2">&quot;opprl_token_2&quot;</span><span class="p">),</span>
    <span class="n">key_service</span><span class="o">=</span><span class="n">acme_keys</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">acme_tokens</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |label|       opprl_token_1|       opprl_token_2|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
<span class="c1"># |    1|O47siK/9rItAv6lwa...|uoPojmvjl3Mk734Ul...|</span>
<span class="c1"># |    1|O47siK/9rItAv6lwa...|uoPojmvjl3Mk734Ul...|</span>
<span class="c1"># |    2|LfRQxBPEW0tEskwxt...|P9PLhpSz+kWSSVmYQ...|</span>
<span class="c1"># |    3|QWvpT0wMEezlurVFM...|W9BxmxZf1/yqIDx3W...|</span>
<span class="c1"># |    4|aS/BfI5qw8UnhOWUX...|nWfWyxQcrSfeiMEHr...|</span>
<span class="c1"># +-----+--------------------+--------------------+</span>
</code></pre></div>
<p>As with <code>transcrypt_out</code>, the <code>token_columns</code> argument is a iterable collection containing the column names of the <code>tokens</code> DataFrame that correspond to tokens that need to be transcrypted. </p>
<p>The <code>key_service</code> argument overrides the default key provider with our Acme Corp keys. The <code>tokenize</code> and <code>transcrypt_out</code> functions also have this parameter.</p>
<h2 id="deployment">Deployment</h2>
<p>Carduus is a Python library that uses PySpark to parallelize and distribute the tokenization and transcryption workloads. Your application that uses Carduus can be submitted to any compatible Spark cluster, or use a connection to a remote spark cluster. Otherwise, Carduus will start a local Spark process that uses the resources of the host machine.</p>
<p>For more information about different modes of deployment, see the official Spark documentation.</p>
<ul>
<li><a href="https://spark.apache.org/docs/latest/submitting-applications.html">Submitting Applications to a Spark cluster</a></li>
<li><a href="https://spark.apache.org/docs/latest/spark-connect-overview.html">Spark Connect</a></li>
<li><a href="https://spark.apache.org/docs/latest/spark-standalone.html">Spark Standalone Mode</a></li>
</ul>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Reference the full <a href="../../api/">API</a></li>
<li>Learn more about using Carduus and extending it's functionality from the advanced user guides:<ul>
<li><a href="../custom-key-provider/">Implementing a custom encryption key provider</a></li>
<li><a href="../databricks/">Using Carduus on Databricks</a></li>
<li><a href="../custom-tokens/">Defining custom token specifications</a></li>
<li><a href="../custom-pii/">Adding support for custom PII attributes</a></li>
</ul>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
    
  </body>
</html>